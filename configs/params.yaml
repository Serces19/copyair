# CopyAir - Image-to-Image Translation Configuration

# Parámetros de entrada/salida
data:
  input_dir: "data/03_processed/input"
  gt_dir: "data/03_processed/gt"
  frames_dir: "data/02_interim/dg"
  output_dir: "output_inference"
  models_dir: "models"

# Parámetros del modelo
model:
  # Arquitecturas disponibles:
  # - unet: U-Net clásica
  # - nafnet: NAFNet HD (mejor para pocas imágenes)
  # - convnext: ConvNeXt U-Net (excelente para few-shot)
  # - convexnet, mambairv2, umamba (otras opciones)
  
  architecture: "nafnet"  # Cambiar a "nafnet" o "convnext" para nuevas arquitecturas
  
  # Para NAFNet y ConvNeXt, especificar tamaño:
  size: "base"  # nano, tiny, small, base, large (según arquitectura)
  
  # Parámetros generales
  in_channels: 3
  out_channels: 3
  base_channels: 64  # Solo para UNet
  activation: "mish"  # Solo para UNet: relu, gelu, mish, silu, leaky_relu
  
  # Para ConvNeXt: drop_path_rate (regularización)
  drop_path_rate: 0.1  # 0.05-0.2 recomendado para pocas imágenes
  
  # Ejemplos de configuración por caso de uso:
  
  # Para 5-8 imágenes (pocas):
  # architecture: "nafnet"
  # size: "small"
  # drop_path_rate: 0.15
  
  # Para 8-12 imágenes (medio):
  # architecture: "convnext"
  # size: "nano"
  # drop_path_rate: 0.1
  
  # Para 12-15 imágenes (más datos):
  # architecture: "nafnet"
  # size: "base"
  # drop_path_rate: 0.05

# Parámetros de entrenamiento
training:
  epochs: 5000
  batch_size: 8
  learning_rate: 1e-3
  weight_decay: 1e-4
  
  # Optimizador
  optimizer:
    type: "adamw" # adam, adamw, sgd, rmsprop
    beta1: 0.9
    beta2: 0.999
    momentum: 0.9 # Solo para SGD
  
  # Learning Rate Scheduler (nuevo sistema flexible!)
  # Opciones: constant, cosine, step, exponential, plateau, onecycle, cosine_warmup
  scheduler:
    type: "constant"  # Usar LR constante (sin scheduler)
    # params: {}  # No necesita parámetros
  
  # Ejemplos de otros schedulers (comentados):
  
  # Cosine Annealing (reduce LR suavemente)
  # scheduler:
  #   type: "cosine"
  #   params:
  #     T_max: 500  # Número de épocas
  #     eta_min: 0  # LR mínimo
  
  # Step LR (reduce LR cada N épocas)
  # scheduler:
  #   type: "step"
  #   params:
  #     step_size: 100  # Reducir cada 100 épocas
  #     gamma: 0.5      # Multiplicar LR por 0.5
  
  # Exponential LR (decay exponencial)
  # scheduler:
  #   type: "exponential"
  #   params:
  #     gamma: 0.98  # Multiplicar LR por 0.98 cada época
  
  # Reduce on Plateau (reduce cuando val_loss se estanca)
  # scheduler:
  #   type: "plateau"
  #   params:
  #     mode: "min"      # Minimizar val_loss
  #     factor: 0.5      # Reducir LR a la mitad
  #     patience: 10     # Esperar 10 épocas sin mejora
  #     verbose: true
  
  # OneCycle LR (para super-convergence)
  # scheduler:
  #   type: "onecycle"
  #   params:
  #     max_lr: 0.01  # LR máximo (se calcula automáticamente si no se especifica)
  
  # Cosine with Warm Restarts
  # scheduler:
  #   type: "cosine_warmup"
  #   params:
  #     T_0: 50        # Primer restart después de 50 épocas
  #     T_mult: 2      # Duplicar periodo en cada restart
  #     eta_min: 0
  
  # Validación
  val_split: 0.2
  
  # Checkpoint
  save_interval: 250
  early_stopping_patience: 500

# Parámetros de pérdida
loss:
  type: "hybrid"  # l1, ssim, hybrid
  lambda_l1: 0.6
  lambda_ssim: 0.2
  lambda_perceptual: 0.15
  lambda_laplacian: 0.05

# Aumentación de datos
augmentation:
  enabled: true
  img_size: 256
  horizontal_flip_p: 0.2
  vertical_flip_p: 0.2
  rotation_limit: 15
  gaussian_noise_p: 0.2
  gaussian_blur_p: 0.2
  color_jitter_p: 0.2

# Hardware
device: "cuda"  # cuda o cpu
num_workers: 4
pin_memory: true

# Logging y experimentos
logging:
  level: "INFO"
  log_dir: "logs"
  
mlflow:
  enabled: true
  experiment_name: "copyair_experiments"
  tracking_uri: "mlruns" # Local directory or server URI

# Inferencia en video
inference:
  target_fps: 24
  frame_sample_rate: 1  # Procesar cada N frames
